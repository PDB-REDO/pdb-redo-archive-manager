<!DOCTYPE html SYSTEM "about:legacy-compat">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:z="http://www.hekkelman.com/libzeep/m2" lang="nl">

<head z:replace="~{head::head(~{::title},~{::head/script})}">
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

	<title>PDB-REDO Archive Manager - Search</title>

	<script src="scripts/search.js"></script>
	<script defer="defer" type="text/javascript" src="scripts/lists.js"></script>
</head>

<body>

	<script z:inline="javascript">
const SOFTWARE = /*[[${software}]]*/ null;
const QUERY = /*[[${query}]]*/ {};
 
const ENTRY_COUNT = /*[[${entry-count}]]*/ 0;
const PAGE_SIZE = /*[[${page-size}]]*/ 10;

let page = /*[[${page}]]*/ 1;
	</script>

	<nav z:replace="~{menu :: navbar('admin')}"></nav>

	<div class="container">

		<h3 class="my-5">Search Archive</h3>

		<form id="query-form">
			<div class="form-row">
				<div class="form-group form-check">
					<input type="checkbox" class="form-check-input" id="latest-only-cb" z:checked="${query.latest}" name="latest"/>
					<label class="form-check-label" for="latest-only-cb">Latest version only</label>
				</div>
			</div>

			<div class="form-row align-items-center" z:each="qi,qix: ${query.filters}">
				<z:block z:if="${qi.t == 'sw'}">
					<div class="col-md-4 my-1">
						<label z:if="${qix.first}" class="mr-sm-2" z:for="|l1-${qix.count}|">Program</label>

						<input class="form-control" type="text" z:value="${qi.s}" readonly="readonly"/>

						<!-- <select class="custom-select mr-sm-2" z:id="|l1-${qix.count}|" name="program">
							<option z:each="sw, i : ${software}" z:selected="${qi.s == sw.name}" z:value="${sw.name}"
								z:text="${sw.name}">
							</option>
						</select> -->
					</div>

					<div class="col-md-2 my-1">
						<label z:if="${qix.first}" class="mr-sm-2" z:for="|l2-${qix.count}|">Version</label>

						<select class="custom-select mr-sm-2" id="|l2-${qix.count}|" name="version">
							<option z:each="swv, i : ${software[#software.indexOf(qi.s)].versions}" z:value="${swv}"
								z:selected="${swv == version}" z:text="${swv}"></option>
						</select>
					</div>

					<div class="col-md-6"></div>
				</z:block>
			</div>

			<div class="form-row align-items-center" z:each="qi,qix: ${query.filters}">
				<z:block z:if="${qi.t == 'd'}">
					<div class="col-md-4 my-1">
						<label z:if="${qix.first}" class="mr-sm-2" z:for="|l1-${qix.count}|">Data</label>

						<input class="form-control" type="text" z:value="${qi.s}" readonly="readonly"/>

						<!-- <select class="custom-select mr-sm-2" z:id="|l1-${qix.count}|" name="program">
							<option z:each="sw, i : ${software}" z:selected="${qi.s == sw.name}" z:value="${sw.name}"
								z:text="${sw.name}">
							</option>
						</select> -->
					</div>

					

					<div class="col-md-2 my-1">
						<label z:if="${qix.first}" class="mr-sm-2" z:for="|l2-${qix.count}|">Version</label>

						<select class="custom-select mr-sm-2" id="|l2-${qix.count}|" name="version">
							<option z:each="swv, i : ${software[#software.indexOf(qi.s)].versions}" z:value="${swv}"
								z:selected="${swv == version}" z:text="${swv}"></option>
						</select>
					</div>
				</z:block>
			</div>

			<div class="form-row align-items-center mt-3">
				<div class="col-auto">
					<button type="button" class="btn btn-secondary mb-2" id="add-program-filter-btn">Add Program Filter</button>
				</div>
				<div class="col-auto">
					<button type="button" class="btn btn-secondary mb-2" id="add-data-filter-btn">Add Data Filter</button>
				</div>
			</div>

			<button type="submit" class="btn btn-primary mt-3">Submit</button>
		</form>


		<div class="row mt-5" z:if="${entries}">

			<p>The search resulted in <span z:text="#numbers.formatDecimal(entry-count, 1, 0)"></span> entries.</p>

			<table class="table table-sm table-hover mt-3" id="entries-table" z:fragment="entries-table-fragment">
				<thead>
					<tr>
						<th>entry ID</th>
						<th>Version Hash</th>
						<th>Date</th>
						<th colspan="5">Links</th>
					</tr>
				</thead>
	
				<tbody>
					<tr z:each="c, i: ${entries}" class="entries-row" z:data-row-id="${c.id}" role="button">
						<td z:text="${c.id}"></td>
						<td z:text="${c.hash}"></td>
						<td z:text="${c.date}"></td>
						<td><a z:href="@{v1/file/${c.id}/${c.hash}/cif}">cif</a></td>
						<td><a z:href="@{v1/file/${c.id}/${c.hash}/mtz}">mtz</a></td>
						<td><a z:href="@{v1/file/${c.id}/${c.hash}/data}">data</a></td>
						<td><a z:href="@{v1/file/${c.id}/${c.hash}/versions}">versions</a></td>
						<td><a z:href="@{v1/file/${c.id}/${c.hash}/zip}">zip</a></td>
					</tr>
				</tbody>
			</table>
	
			<nav aria-label="paging entries">
				<ul class="pagination pagination-sm" id="stable-pager">
					<li class="page-item disabled" data-page-id="previous">
						<a class="page-link" role="button">Previous</a>
					</li>
					<li class="page-item disabled">
						<a class="page-link" role="button">...</a>
					</li>
					<li class="page-item" z:each="p: ${ { 1, 2, 3, 4, 5 } }" z:classappend="${p == page ? 'active'}"
						z:data-page-id="${p}">
						<a class="page-link" role="button" z:text="${p}"></a>
					</li>
					<li class="page-item disabled">
						<a class="page-link" role="button">...</a>
					</li>
					<li class="page-item" data-page-id="next">
						<a class="page-link" role="button">Next</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</body>

</html>